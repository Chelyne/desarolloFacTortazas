<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button color="primary" menu="primerMenu">
      </ion-menu-button>
    </ion-buttons>
    <ion-title color="primary">Compras</ion-title>
    <ion-buttons slot="end">
      <ion-button color="primary" [routerLink]="[ '/lista-de-compras' ]">
        <ion-label>Lista de Compras</ion-label>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-card>
    <ion-card-header color="primary">
      <ion-card-title class="ion-text-center">
        <ion-label color="light">Nueva compra</ion-label>
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
    <form [formGroup]="formComprobante" class='comprobante'>
      <ion-grid>
        <ion-row>
          <ion-col>
            <ion-item lines="none ">
              <ion-label color="primary" position="stacked">Tipo de comprobante</ion-label>
              <ion-select class="custom-options" value="facElectronica" mode="ios" interface="popover" formControlName="tipoComp">
                <ion-select-option value="facElectronica">Factura Electrónica</ion-select-option>
                <ion-select-option value="boletaVenta">Boleta de venta</ion-select-option>
                <ion-select-option value="guia">Guía</ion-select-option>
                <ion-select-option value="notaEntrada">Nota de entrada</ion-select-option>
                <ion-select-option value="reciboPorHonorarios">Recibo por Honorarios</ion-select-option>
                <ion-select-option value="serviciosPublicos">Servicios Publicos</ion-select-option>
              </ion-select>
            </ion-item>
          </ion-col>
          <ion-col>
            <ion-item lines="none ">
              <ion-label color="primary" position="floating">Serie<ion-text color="danger">*</ion-text></ion-label>
              <ion-input type="text" formControlName="serieComp" placeholder="Ingrese la serie"></ion-input>
            </ion-item>
            <div class="alertDanger" *ngIf="serieComp.invalid && (serieComp.dirty || serieComp.touched)">
              <div class="mensajeError" *ngIf="serieComp.errors.required">
                *Complete la serie del comprobante
              </div>
            </div>
          </ion-col>
          <ion-col>
            <ion-item lines="none ">
              <ion-label color="primary" position="floating">Número<ion-text color="danger">*</ion-text></ion-label>
              <ion-input required type="text" formControlName="numeroComp" placeholder="Ingrese el número"></ion-input>
            </ion-item>
            <div class="alertDanger" *ngIf="numeroComp.invalid && (numeroComp.dirty || numeroComp.touched)">
              <div class="mensajeError" *ngIf="numeroComp.errors.required">
                *Complete el numero del comprobante
              </div>
            </div>
          </ion-col>
          <ion-col>
            <ion-item lines="none ">
              <ion-label color="primary" position="stacked" >Fecha de Emisión</ion-label>
              <ion-input type="date" formControlName="fechaEmisionComp" class="form-control"></ion-input>
              <!-- <ion-datetime display-format="DD/MM/YYYY" formControlName="fechaEmisionComp"></ion-datetime> -->
            </ion-item>
          </ion-col>
        </ion-row>
      </ion-grid>
    </form>
    <ion-item-divider>
      <ion-label>Proveedor</ion-label>
    </ion-item-divider>
    <ion-item lines="none">
      <ion-label color="primary" position="floating">Proveedor</ion-label>
      <!-- {{provedorObtenido.ruc}} - {{provedorObtenido.nombre}} -->
      <ion-input (click)="modalProveedor()" placeholder="Seleccionar proveedor" [value]="provedorObtenido?provedorObtenido.ruc + ' - ' + provedorObtenido.nombre:''" type="text"></ion-input>
    </ion-item>
    <ion-item-divider>
      <ion-label>Productos</ion-label>
    </ion-item-divider>

    <!-- AGREGA PRODUCTOS CON MODAL NO BORRAR -->
    <!-- <ion-item>
      <ion-button (click)="agregarProductoCompra()">
        <ion-icon color="light" name="add-circle-outline"></ion-icon> &nbsp;
        <ion-label color="light">Agregar producto</ion-label>
      </ion-button>
    </ion-item> -->
    <ion-grid>
      <ion-row class="headerItems">
        <ion-col size="0.5">
          <ion-label color="light">#</ion-label>
        </ion-col>
        <ion-col>
          <ion-label color="light">Nombre</ion-label>
        </ion-col>
        <ion-col>
          <ion-label color="light">Unidad</ion-label>
        </ion-col>
        <ion-col>
          <ion-label color="light">Cantidad</ion-label>
        </ion-col>
        <ion-col>
          <ion-label color="light">?valorUnitario?</ion-label>
        </ion-col>
        <ion-col>
          <ion-label color="light">PU compra</ion-label>
        </ion-col>
        <ion-col>
          <ion-label color="light">Descuento</ion-label>
        </ion-col>
        <ion-col>
          <ion-label color="light">Cargo</ion-label>
        </ion-col>
        <ion-col>
          <ion-label color="light">Total</ion-label>
        </ion-col>
        <ion-col>
          <ion-label color="light">Acciones</ion-label>
        </ion-col>
      </ion-row>
      <ion-row *ngFor="let itemCompra of listaItemsDeCompra;let i = index" class="ion-justify-content-center ion-align-items-center contentItems">
        <ion-col size="0.5">{{i+1}}</ion-col>
        <ion-col>{{itemCompra.producto.nombre | titlecase}}</ion-col>
        <ion-col>{{itemCompra.producto.unidad!=null?itemCompra.producto.unidad:'NaN'}}</ion-col>
        <ion-col>{{itemCompra.cantidad}}</ion-col>
        <ion-col>????</ion-col>
        <ion-col>{{itemCompra.PU_compra}}</ion-col>
        <ion-col>{{itemCompra.descuento}}</ion-col>
        <ion-col>????</ion-col>
        <ion-col>{{itemCompra.totalCompraxProducto}}</ion-col>
        <ion-col>
          <ion-button size="small" color="success" (click)="EditarItemDeCompra(itemCompra)">
            <ion-icon color="light" name="create-outline" ></ion-icon>
          </ion-button>
          <ion-button size="small" color="danger" (click)="EliminarItemDeCompra(itemCompra.id)">
            <ion-icon color="light" name="trash-outline" ></ion-icon>
          </ion-button>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col>
          <ion-item *ngIf="!ACTUALIZAR_COMPRA">
            <ion-label>IGV</ion-label>
            <ion-label>Total: {{totalxCompra}}</ion-label>
            <ion-button (click)="limpiarListaDeCompras()"  [disabled]="!listaItemsDeCompra.length">
              Cancelar
            </ion-button>
            <ion-button (click)="generarCompra()" [disabled]="formComprobante.invalid">
              Comprar/Generar
            </ion-button>
          </ion-item>
          <ion-item  *ngIf="ACTUALIZAR_COMPRA">
            <ion-label>IGV</ion-label>
            <ion-label>Total: {{totalxCompra}}</ion-label>
            <ion-button [disabled]="!listaItemsDeCompra.length" routerLink="/lista-de-compras" (click)="cancelarActulizarCompra()">
              Cancelar
            </ion-button>
            <ion-button (click)="ActualizarCompra()" [disabled]="formComprobante.invalid" routerLink="/lista-de-compras">
              Actualiazar
            </ion-button>
          </ion-item>
        </ion-col>
      </ion-row>
    </ion-grid>
    <ion-item-divider></ion-item-divider>
    </ion-card-content>
  </ion-card>
  <!-- <ion-item-divider></ion-item-divider>


  <ion-item class="data-proveedor" lines="none">
    <ion-item>
      <ion-header>
        <ion-label>Proveedor</ion-label>
      </ion-header>
    </ion-item>
    <ion-item>
      <ion-label position="stacked">Proveedor</ion-label>
      <ion-input type="text" placeholder="Proveedor" [value]="nameRuc"></ion-input>
      <ion-button (click)="abriModalProveedor()">
        Seleccionar proveedor
      </ion-button>
    </ion-item>
  </ion-item> -->

  <ion-item-divider>BUSCAR PRODUCTOS PARA AGREGAR</ion-item-divider>

  <ion-grid>
    <ion-row>
      <ion-col size="6">
        <ion-item lines='none'>
          <ion-searchbar style="width: 100%;" slot="end" (ionClear)="limpiarBuscador()" (ionChange)="Search($event)" #search placeholder="Buscar" inputmode="text" debounce="500" mode="ios"></ion-searchbar>
        </ion-item>
        <ion-row class="headerPROD">
          <ion-col size="1">
            <ion-label>#</ion-label>
          </ion-col>
          <ion-col>
            <ion-label>Nombre</ion-label>
          </ion-col>
          <ion-col>
            <ion-label>Cant. Stock</ion-label>
          </ion-col>
          <ion-col>
            <ion-label>Precio</ion-label>
          </ion-col>
        </ion-row>
        <ion-row class="contentPROD" (click)="seleccionarProducto(prod)" *ngFor="let prod of listaDeProductos; let i = index">
          <ion-col size="1">
            <ion-label>{{i+1}}</ion-label>
          </ion-col>
          <ion-col>
            <ion-label>{{prod.nombre | titlecase}}</ion-label>
          </ion-col>
          <ion-col>
            <ion-label>{{prod.cantStock}}</ion-label>
          </ion-col>
          <ion-col>
            <ion-label>{{prod.precio | number:'1.2'}}</ion-label>
          </ion-col>
        </ion-row>
        <ion-item>
          <ion-button slot="end" (click)="AgregarNuevoProducto()">
            Agregar Producto
          </ion-button>
        </ion-item>
      </ion-col>

      <ion-col size="6">
        <ion-item>
          <ion-label>Editar Producto de compra</ion-label>
        </ion-item>

        <form [formGroup]="formItemDeCompras" readonly *ngIf="productSelect">
          <ion-item lines="none">
            <ion-label position="floating" color="primary">Nombre del producto<ion-text color="danger">*</ion-text></ion-label>
            <ion-input placeholder="Nombre" required  type="text" readonly formControlName="nombre"></ion-input>
          </ion-item>
          <ion-item lines="none">
            <ion-label position="floating" color="primary">Descripción</ion-label>
            <ion-input placeholder="Descripcion" type="text" readonly formControlName="descripcion"></ion-input>
          </ion-item>
          <ion-item lines="none">
            <ion-label position="floating" color="primary">Cantidades<ion-text color="danger">*</ion-text></ion-label>
            <ion-input placeholder="Cantidad" required type="text" formControlName="cantidad" placeholder="00"></ion-input>
            <div class="alertDanger" *ngIf="cantidad.invalid && (cantidad.dirty || cantidad.touched)">
              <div class="mensajeError" *ngIf="cantidad.errors.required">
                *Ingrese cantidad
              </div>
              <div class="mensajeError" *ngIf="cantidad.errors.pattern">
                *solo ingrese numeros
              </div>
            </div>
          </ion-item>
          <ion-item lines="none">
            <ion-label position="floating" color="primary">Precio Unitario de compra(s/.)<ion-text color="danger">*</ion-text></ion-label>
            <ion-input placeholder="Precio" required type="text" formControlName="pu_compra" placeholder="00.00"></ion-input>
            <div class="alertDanger" *ngIf="pu_compra.invalid && (pu_compra.dirty || pu_compra.touched)">
              <div class="mensajeError" *ngIf="pu_compra.errors.required">
                *Ingrese precio unitario compra
              </div>
              <div class="mensajeError" *ngIf="pu_compra.errors.pattern">
                *solo formato de moneda 00.00
              </div>
            </div>
          </ion-item>
          <ion-item lines="none">
            <ion-label position="floating" color="primary">Decuento</ion-label>
            <ion-input placeholder="Descuento" type="text" formControlName="descuento" placeholder="00.00"></ion-input>
            <div class="alertDanger" *ngIf="descuento.invalid && (descuento.dirty || descuento.touched)">
              <div class="mensajeError" *ngIf="descuento.errors.pattern">
                *solo formato de moneda 00.00
              </div>
            </div>
          </ion-item>
          <ion-button size="small" block color="primary" slot="end" (click)="limpiarProductSelect()">
            <ion-label color="light">Limpiar</ion-label>
          </ion-button>
          <ion-button size="small"  block color="primary"
          [disabled]="formItemDeCompras.invalid" slot="end" (click)="AgregarAListaDeCompra()">
            <ion-label color="light">Agregar a lista</ion-label>
          </ion-button>
        </form>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>

